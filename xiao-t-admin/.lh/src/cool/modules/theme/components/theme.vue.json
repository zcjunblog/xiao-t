{
    "sourceFile": "src/cool/modules/theme/components/theme.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1625209008000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1625209008000,
            "name": "Commit-0",
            "content": "<template>\n\t<div class=\"cl-theme\">\n\t\t<li @click=\"open\">\n\t\t\t<icon-svg :size=\"18\" name=\"icon-theme\" />\n\t\t</li>\n\n\t\t<!-- 系统设置 -->\n\t\t<el-drawer v-model=\"drawer.visible\" title=\"系统设置\" size=\"300px\">\n\t\t\t<div class=\"cl-theme__container\">\n\t\t\t\t<div class=\"cl-theme__color is-card\">\n\t\t\t\t\t<p>主题</p>\n\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<el-tooltip\n\t\t\t\t\t\t\tv-for=\"(item, name) in themeList\"\n\t\t\t\t\t\t\t:key=\"name\"\n\t\t\t\t\t\t\t:content=\"item.label\"\n\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t\t\t\tbackgroundColor: item.color\n\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t\t@click=\"setTheme(item)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\tv-show=\"item.color == form.theme.color\"\n\t\t\t\t\t\t\t\t\tclass=\"el-icon-check\"\n\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</el-tooltip>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"cl-theme__switch is-card\">\n\t\t\t\t\t<p>内容区域</p>\n\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li v-if=\"!browser.isMini\">\n\t\t\t\t\t\t\t<span>显示一级菜单栏</span>\n\t\t\t\t\t\t\t<el-switch\n\t\t\t\t\t\t\t\tv-model=\"form.conf.showAMenu\"\n\t\t\t\t\t\t\t\tsize=\"mini\"\n\t\t\t\t\t\t\t\t@change=\"onAMenuChange\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<span>显示路由导航栏</span>\n\t\t\t\t\t\t\t<el-switch v-model=\"form.conf.showRouteNav\" size=\"mini\" />\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<span>显示页面进程栏</span>\n\t\t\t\t\t\t\t<el-switch v-model=\"form.conf.showProcess\" size=\"mini\" />\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"cl-theme__append\">\n\t\t\t\t\t<slot></slot>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"cl-theme__tips\" v-if=\"isDev\">\n\t\t\t\t\t<el-alert\n\t\t\t\t\t\ttype=\"warning\"\n\t\t\t\t\t\t:closable=\"false\"\n\t\t\t\t\t\tshow-icon\n\t\t\t\t\t\ttitle=\"手动修改配置文件可设置为默认主题、布局。\"\n\t\t\t\t\t/>\n\n\t\t\t\t\t<el-button\n\t\t\t\t\t\tround\n\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tstyle=\"width: 100%\"\n\t\t\t\t\t\t:disabled=\"!form.theme.url\"\n\t\t\t\t\t\t@click=\"openDesc\"\n\t\t\t\t\t\t>修改说明</el-button\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</el-drawer>\n\n\t\t<!-- 修改说明 -->\n\t\t<cl-dialog\n\t\t\tv-model=\"desc.visible\"\n\t\t\ttitle=\"修改说明\"\n\t\t\twidth=\"800px\"\n\t\t\t:props=\"{\n\t\t\t\t'append-to-body': true\n\t\t\t}\"\n\t\t>\n\t\t\t<ul class=\"cl-theme__desc\">\n\t\t\t\t<li>\n\t\t\t\t\t<p class=\"cl-theme__desc-label\">修改主题色：</p>\n\t\t\t\t\t<cl-codemirror v-model=\"desc.color\" />\n\t\t\t\t</li>\n\n\t\t\t\t<li>\n\t\t\t\t\t<p class=\"cl-theme__desc-label\">修改应用配置：</p>\n\t\t\t\t\t<cl-codemirror v-model=\"desc.conf\" />\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</cl-dialog>\n\t</div>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport { isDev } from \"/@/config/env\";\nimport { isArray, cloneDeep } from \"/@/core/utils\";\n\nexport default {\n\tname: \"cl-theme\",\n\n\tprops: {\n\t\tlist: Array\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tdrawer: {\n\t\t\t\tvisible: false\n\t\t\t},\n\t\t\tdesc: {\n\t\t\t\tvisible: false,\n\t\t\t\tcolor: \"\",\n\t\t\t\tconf: \"\"\n\t\t\t},\n\t\t\tthemes: [\n\t\t\t\t{\n\t\t\t\t\tlabel: \"魅紫\",\n\t\t\t\t\tname: \"blue\",\n\t\t\t\t\tcolor: \"#8595F4\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"极黑\",\n\t\t\t\t\tname: \"black\",\n\t\t\t\t\tcolor: \"#2f3447\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"果绿\",\n\t\t\t\t\tname: \"green\",\n\t\t\t\t\tcolor: \"#51C21A\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: \"酱紫\",\n\t\t\t\t\tname: \"purple\",\n\t\t\t\t\tcolor: \"#d0378d\"\n\t\t\t\t}\n\t\t\t],\n\t\t\tisDev,\n\t\t\tform: {\n\t\t\t\tname: \"\",\n\t\t\t\tconf: {\n\t\t\t\t\tshowAMenu: false,\n\t\t\t\t\tshowRouteNav: true,\n\t\t\t\t\tshowProcess: true\n\t\t\t\t},\n\t\t\t\ttheme: {\n\t\t\t\t\tcolor: \"\",\n\t\t\t\t\turl: \"\"\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t},\n\n\tcomputed: {\n\t\t...mapGetters([\"app\", \"modules\", \"browser\"]),\n\n\t\tthemeList() {\n\t\t\treturn isArray(this.list) ? this.list : this.themes;\n\t\t}\n\t},\n\n\twatch: {\n\t\tapp: {\n\t\t\timmediate: true,\n\t\t\thandler(val) {\n\t\t\t\tthis.form = cloneDeep(val);\n\t\t\t}\n\t\t},\n\n\t\tform: {\n\t\t\tdeep: true,\n\t\t\thandler(val) {\n\t\t\t\tthis.$store.commit(\"UPDATE_APP\", val);\n\t\t\t}\n\t\t}\n\t},\n\n\tmethods: {\n\t\topen() {\n\t\t\tthis.drawer.visible = true;\n\t\t},\n\n\t\tclose() {\n\t\t\tthis.drawer.visible = false;\n\t\t},\n\n\t\tonAMenuChange() {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$store.commit(\"SET_MENU_LIST\");\n\t\t\t}, 0);\n\t\t},\n\n\t\t// 设置主题\n\t\tsetTheme({ name, color, label }) {\n\t\t\tif (this.form.theme.color == color) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.$message.success(`切换主题：${label}`);\n\n\t\t\tconst theme = document.getElementById(\"theme-style\");\n\t\t\tconst style = theme || document.createElement(\"link\");\n\n\t\t\tstyle.href = `${this.modules.theme.options.sourceUrl || \"/theme/\"}${name}.css`;\n\n\t\t\tif (!theme) {\n\t\t\t\tstyle.type = \"text/css\";\n\t\t\t\tstyle.rel = \"stylesheet\";\n\t\t\t\tstyle.id = \"theme-style\";\n\n\t\t\t\tdocument.getElementsByTagName(\"head\").item(0).appendChild(style);\n\t\t\t}\n\n\t\t\t// 设置主题色和路径\n\t\t\tthis.form.theme.color = color;\n\t\t\tthis.form.theme.url = style.href;\n\n\t\t\t// 设置 css 变量\n\t\t\tdocument.getElementsByTagName(\"body\")[0].style.setProperty(\"--color-primary\", color);\n\t\t},\n\n\t\t// 打开修改说明\n\t\topenDesc() {\n\t\t\tthis.desc.visible = true;\n\n\t\t\tthis.desc.color = `\n\t\t\t\t// src/assets/css/common.scss\n\t\t\t\t$primary: ${this.form.theme.color};\n\t\t\t`;\n\n\t\t\tthis.desc.conf = `\n\t\t\t\t// src/config/env.js\n\t\t\t\texport const app = {\n\t\t\t\t\tconf: ${JSON.stringify(this.form.conf)},\n\t\t\t\t\ttheme: {\n\t\t\t\t\t\turl: \"${this.form.theme.url}\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`;\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"scss\">\n.cl-theme {\n\t.el-drawer {\n\t\t&__header {\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\n\t\t&__body {\n\t\t\theight: calc(100% - 63px);\n\t\t}\n\t}\n\n\t&__container {\n\t\theight: 100%;\n\t\toverflow: auto;\n\n\t\t&::-webkit-scrollbar {\n\t\t\twidth: 6px;\n\t\t}\n\n\t\t&::-webkit-scrollbar-thumb {\n\t\t\tborder-radius: 6px;\n\t\t\tbackground-color: rgba(144, 147, 153, 0.3);\n\t\t}\n\t}\n\n\t.is-card {\n\t\tpadding: 20px 0;\n\t\tmargin: 0 20px 20px 20px;\n\t\tborder-bottom: 1px solid #f7f7f7;\n\n\t\t& > p {\n\t\t\tfont-size: 15px;\n\t\t\tfont-weight: bold;\n\t\t\tmargin-bottom: 10px;\n\t\t}\n\t}\n\n\t&__switch {\n\t\tul {\n\t\t\twidth: 100%;\n\n\t\t\tli {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\theight: 40px;\n\t\t\t\tlist-style: none;\n\n\t\t\t\tspan {\n\t\t\t\t\tfont-size: 13px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t&__color {\n\t\tul {\n\t\t\tdisplay: flex;\n\t\t\tflex-wrap: wrap;\n\t\t\tmargin-top: 10px;\n\n\t\t\tli {\n\t\t\t\tlist-style: none;\n\t\t\t\theight: 20px;\n\t\t\t\twidth: 20px;\n\t\t\t\tborder-radius: 3px;\n\t\t\t\tmargin-right: 10px;\n\t\t\t\tmargin-top: 10px;\n\t\t\t\ttext-align: center;\n\t\t\t\tcolor: #fff;\n\t\t\t\tline-height: 20px;\n\n\t\t\t\t&:hover {\n\t\t\t\t\topacity: 0.7;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t&__tips {\n\t\tpadding: 10px 20px;\n\t\tmargin-bottom: 50px;\n\n\t\t.el-button {\n\t\t\tmargin-top: 20px;\n\t\t}\n\t}\n\n\t&__desc {\n\t\tpadding: 10px;\n\n\t\t&-label {\n\t\t\tmargin-bottom: 10px;\n\t\t}\n\n\t\tli {\n\t\t\tlist-style: none;\n\t\t\tmargin-bottom: 20px;\n\t\t}\n\t}\n}\n</style>\n"
        }
    ]
}